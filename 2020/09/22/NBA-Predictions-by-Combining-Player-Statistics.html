<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>NBA Predictions by Combining Individual Player Statistics | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="NBA Predictions by Combining Individual Player Statistics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An easy to use blogging platform with support for Jupyter Notebooks." />
<meta property="og:description" content="An easy to use blogging platform with support for Jupyter Notebooks." />
<link rel="canonical" href="https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html" />
<meta property="og:url" content="https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-22T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"An easy to use blogging platform with support for Jupyter Notebooks.","@type":"BlogPosting","headline":"NBA Predictions by Combining Individual Player Statistics","dateModified":"2020-09-22T00:00:00-05:00","datePublished":"2020-09-22T00:00:00-05:00","url":"https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/portfolio_blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://mood2jam.github.io/portfolio_blog/feed.xml" title="fastpages" /><link rel="shortcut icon" type="image/x-icon" href="/portfolio_blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>NBA Predictions by Combining Individual Player Statistics | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="NBA Predictions by Combining Individual Player Statistics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An easy to use blogging platform with support for Jupyter Notebooks." />
<meta property="og:description" content="An easy to use blogging platform with support for Jupyter Notebooks." />
<link rel="canonical" href="https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html" />
<meta property="og:url" content="https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-22T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"An easy to use blogging platform with support for Jupyter Notebooks.","@type":"BlogPosting","headline":"NBA Predictions by Combining Individual Player Statistics","dateModified":"2020-09-22T00:00:00-05:00","datePublished":"2020-09-22T00:00:00-05:00","url":"https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://mood2jam.github.io/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://mood2jam.github.io/portfolio_blog/feed.xml" title="fastpages" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/portfolio_blog/">fastpages</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/portfolio_blog/extra_posts/2020-01-14-test-markdown-post.html">An Example Markdown Post</a><a class="page-link" href="/portfolio_blog/about/">About Me</a><a class="page-link" href="/portfolio_blog/search/">Search</a><a class="page-link" href="/portfolio_blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">NBA Predictions by Combining Individual Player Statistics</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-09-22T00:00:00-05:00" itemprop="datePublished">
        Sep 22, 2020
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      19 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/mood2jam/portfolio_blog/tree/master/_notebooks/2020-14-09-NBA-Predictions-by-Combining-Player-Statistics.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/portfolio_blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/mood2jam/portfolio_blog/master?filepath=_notebooks%2F2020-14-09-NBA-Predictions-by-Combining-Player-Statistics.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/portfolio_blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/mood2jam/portfolio_blog/blob/master/_notebooks/2020-14-09-NBA-Predictions-by-Combining-Player-Statistics.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/portfolio_blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-14-09-NBA-Predictions-by-Combining-Player-Statistics.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><div class="flash">
    <svg class="octicon octicon-info" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 01-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 01-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg>
    <strong>Note: </strong>This work was completed on April 14, 2020 as part of a capstone undergraduate project with Mingyan Zhao from Brigham Young University.
</div></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predicting basketball games is a popular pastime for enthusiasts of the sport as well as an important job in sports analytics. NBA front offices want to know if a certain player will give them the unique edge they are looking for to make it to the next round in the playoffs. There are many factors to consider when predicting wins: players, teamwork, chemistry, and variations in individual performance all come into play. Many models look at teams as a whole and use this to predict on court success. In contrast, we have developed a method that is able to predict team wins by combining player stats and normalizing them based on engineered features. This post looks at data scraping, clearning, and exploratory data anaylsis. Part 2 looks at different machine learning methods for game predicition using classifiers and regressors. In the end, we are able to achieve close to 70% accuracy on our test dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Our-Objective">Our Objective<a class="anchor-link" href="#Our-Objective"> </a></h2><p>Much work has been done previously to predict wins. There are matchup predictors on popular sports websites like espn.com and fivethirtyeight.com and research papers have been written addressing the subject. For instance [1] highlights how OLS regression can be used to predict wins by incorporating strength of teams and other important factors including home team advantage, whether or not a team played back-to-back games, etc. 
Another example of game prediction comes from [2] where the authors use neural networks to help in their predictions.</p>
<p>When we approached our model we wanted to do something a little bit different. Instead of focusing solely on team performance/stats in predicting wins, we wanted the ability to remove and replace players on a team and see how that affects team performance. This would greatly help game prediction because often teams go into a new season with a new combination of players or players get injured throughout the season.</p>
<p>More specifically we had the following questions: How can we swap out players to predict team performance? How do we adjust team stats so if a new player is hogging the ball (and minutes) it will diminish the effect of the other players around him? Can we simulate games by drawing from an empirical distribution of player stats and then combining them into team stats?</p>
<p>We believe this model will fit into current research by offering a unique perspective on game prediction. It will offer the ability to look at different combinations of players to find the optimal lineups. The model also gives the ability to see how playing time, shot attempts, and free throw attempts of players affects team performance. This could be especially useful for coaches, who have control of how long to play specific players (playing time) and how much they should encourage players to shoot the ball (shot attempts) and how much to drive the ball (which leads to free throw attempts).</p>
<p>By converting player stats into team stats, we can effectively simulate games by drawing from an empirical distribution of past player performance and then combining our draws into team data. We can then use the team data to predict head to head matchups. This is the overall idea of our model.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview-of-the-data">Overview of the data<a class="anchor-link" href="#Overview-of-the-data"> </a></h2><p>In order to create a model with these characteristics, we had to figure out how to turn player stats into team stats and what type of data we wanted to look at. In professional basketball, there are two types of stats: traditional and advanced. Traditional stats can be easily measured during the game like shots attempted and three-point shooting percentage. Advanced stats can be thought of as hand-engineered features made from traditional stats. For example effective field goal percentage, an advanced stat, takes into account that three-point field goals are worth more than two-point field goals and is normalized by field goals attempted. Advanced stats are useful because they are normalized and usually percentages. When predicting team wins, we decided to use advanced stats because of these favorable qualities. However, we need traditional and advanced player stats to create the advanced team stats.</p>
<p>Thus, our dataset has two parts, both from basketball-reference.com: a popular, valid source for team and player basketball stats.</p>
<ol>
<li><code>Merged Player and Team Stats (Advanced and Traditional):</code> We use this table to draw from an empirical distribution. Once specific stats are drawn, we can convert them to team stats. This first part of the dataset covers the past two seasons (including playoffs). Drawing player statistics from too far in the past will not give a good representation of the player's current ability (the player is likely to improve or decline over long periods of time). </li>
</ol>
<p><img src="/portfolio_blog/images/copied_from_nb/images/data.png" alt="title" /></p>
<ol>
<li><code>Merged Team Stats and Opposing Team Stats (Advanced):</code> This table goes back seven seasons. Since this data is is not labeled by team or player, we can use as much of it as we want. This is the data we use to train our logistic regression model. </li>
</ol>
<p><img src="/portfolio_blog/images/copied_from_nb/images/team_data.png" alt="title" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data-Collection-and-Cleaning">Data Collection and Cleaning<a class="anchor-link" href="#Data-Collection-and-Cleaning"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Scraping">Data Scraping<a class="anchor-link" href="#Data-Scraping"> </a></h2><p>We first got the links of all the websites that have player and games stats. Then we run through all the websites to get the player stats and team stats. We loaded data into a pandas dataframe. We then combined each player's stats with their team and opposing team's data and saved the resulting file. We also saved team data as an another file.</p>
<p>Here is some simplified code:</p>
<div class="highlight"><pre><span></span><span class="c1"># Get all the urls of all the games in last five years</span>
<span class="n">month0</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;october&#39;</span><span class="p">,</span><span class="s1">&#39;november&#39;</span><span class="p">,</span><span class="s1">&#39;december&#39;</span><span class="p">,</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span><span class="s1">&#39;march&#39;</span><span class="p">,</span><span class="s1">&#39;april&#39;</span><span class="p">,</span><span class="s1">&#39;may&#39;</span><span class="p">,</span><span class="s1">&#39;june&#39;</span><span class="p">]</span>
<span class="n">month1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;december&#39;</span><span class="p">,</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span><span class="s1">&#39;march&#39;</span><span class="p">,</span><span class="s1">&#39;april&#39;</span><span class="p">,</span><span class="s1">&#39;may&#39;</span><span class="p">,</span><span class="s1">&#39;june&#39;</span><span class="p">]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span><span class="mi">2018</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Set the urls</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://www.basketball-reference.com/leagues/NBA_2018_games-&#39;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">month</span><span class="p">]</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through all the years</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="c1"># 2012 had less games, so it is an exception</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39;2012&#39;</span><span class="p">:</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">month1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">month0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">month</span><span class="p">:</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;https://www.basketball-reference.com/leagues/NBA_&#39;</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="s1">&#39;_games-&#39;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>

<span class="c1"># Save URLs for all games in each month</span>
<span class="n">websites</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Box Score&#39;</span><span class="p">)</span>
    <span class="n">tags</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://www.basketball-reference.com&#39;</span><span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">query</span><span class="p">]</span>
    <span class="n">websites</span> <span class="o">+=</span> <span class="n">tags</span>
</pre></div>
<p>Here is the code for scraping team data from the urls.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">game_stats</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>

    <span class="n">soup1</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="c1"># Team info</span>
    <span class="n">infos</span> <span class="o">=</span> <span class="n">soup1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;suppress_all sortable stats_table now_sortable&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tbody</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>

    <span class="c1"># Get the different tables</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">soup1</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;sortable stats_table now_sortable&#39;</span><span class="p">)</span>

    <span class="c1"># Get the team names and scores</span>
    <span class="n">team_name1</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
    <span class="n">score1</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
    <span class="n">team_name2</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
    <span class="n">score2</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>

    <span class="c1"># Check and set the win condition and convert to binary output</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">score1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">score2</span><span class="p">):</span>
        <span class="n">win1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">win2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">win1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">win2</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Save team stats</span>
    <span class="n">team_basic</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tfoot</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">team_basic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">team_adv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tfoot</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">team_adv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">op_basic</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tfoot</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">op_basic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">op_adv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tfoot</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>   
        <span class="n">op_adv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">team_name1</span><span class="p">,</span><span class="n">team_name2</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">win1</span><span class="p">]</span> <span class="o">+</span> <span class="n">team_basic</span><span class="o">+</span> <span class="n">team_adv</span><span class="p">)</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">team_name2</span><span class="p">,</span><span class="n">team_name1</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">win2</span><span class="p">]</span> <span class="o">+</span> <span class="n">op_basic</span><span class="o">+</span> <span class="n">op_adv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">o</span>
</pre></div>
<p>We scraped the player data in a similar way.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Cleaning">Data Cleaning<a class="anchor-link" href="#Data-Cleaning"> </a></h2><p>Most of data has the right format when we saved them in pandas dataframe. We made sure that all the quantitative variables were floats. We changed the dates in the tables to pandas datetime index and minutes played to seconds played. We also changed most variable names so they were consistent and we could merge player and team data.</p>
<div class="highlight"><pre><span></span><span class="c1"># Fix player stat data</span>
<span class="n">player_stats</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">player_stats</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Convert from minutes played to seconds played (will be useful later)</span>
<span class="n">player_stats</span><span class="p">[</span><span class="s1">&#39;MP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">player_stats</span><span class="p">[</span><span class="s1">&#39;MP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)]</span>

<span class="c1"># Create consistent column names</span>
<span class="n">player_stats</span> <span class="o">=</span> <span class="n">player_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;win&quot;</span><span class="p">:</span> <span class="s2">&quot;W/L TEAM&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;DATE&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">:</span><span class="s2">&quot;TEAM NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;op_team&quot;</span><span class="p">:</span><span class="s2">&quot;OPP TEAM NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">:</span><span class="s2">&quot;TEAM SCORE&quot;</span><span class="p">,</span> <span class="s2">&quot;op_score&quot;</span><span class="p">:</span><span class="s2">&quot;OPP TEAM SCORE&quot;</span><span class="p">,</span> <span class="s2">&quot;MP&quot;</span><span class="p">:</span><span class="s2">&quot;SP&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="c1"># Put the dates in a correct format</span>
<span class="n">team_stats</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">team_stats</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Convert minutes played to seconds played</span>
<span class="n">team_stats</span><span class="p">[</span><span class="s1">&#39;MP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_stats</span><span class="p">[</span><span class="s2">&quot;MP&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mi">5</span>

<span class="c1"># Change the column names to be consistent</span>
<span class="n">team_stats</span> <span class="o">=</span> <span class="n">team_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;DATE&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">:</span><span class="s2">&quot;TEAM NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;op_team&quot;</span><span class="p">:</span><span class="s2">&quot;OPP TEAM NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;MP&quot;</span><span class="p">:</span><span class="s2">&quot;SP&quot;</span><span class="p">,</span> <span class="s2">&quot;win&quot;</span><span class="p">:</span> <span class="s2">&quot;W/L&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="c1"># Merge the player and team stats into one table</span>
<span class="n">all_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">player_stats</span><span class="p">,</span> <span class="n">team_stats</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TEAM NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;OPP TEAM NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;DATE&quot;</span><span class="p">,</span> <span class="s2">&quot;W/L TEAM&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Model-Selection-and-Feature-Engineering">Model Selection and Feature Engineering<a class="anchor-link" href="#Model-Selection-and-Feature-Engineering"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-Selection">Model Selection<a class="anchor-link" href="#Model-Selection"> </a></h2><p>We determined that logistic regression was useful our application because we were trying to predict the chance of a team winning (which is fit on binary output). We knew we wanted to use advanced, normalized stats as input so we looked at the Akaike Information Criterion (AIC) of models with different feature combinations.</p>
<p>After looking at different combinations of features, we had the following results:</p>
<p><img src="/portfolio_blog/images/copied_from_nb/images/ft.png" alt="title" /></p>
<p>The features chosen for our model denoted in by (1). Notice that this combination of features does not have the lowest AIC. However it isn't too far away from the other models and we wanted to have a small number of features. The less features, the less variation when we convert player stats into team stats. We didn't feel that adding the extra features would help our model substantially.</p>
<p>Here are the results of Logisitic Regression (with L1 Regularization) for our chosen features:</p>
<div class="highlight"><pre><span></span><span class="n">best_features_aic</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TS% TEAM&#39;</span><span class="p">,</span> <span class="s1">&#39;TOV% TEAM&#39;</span><span class="p">,</span> <span class="s1">&#39;DRB% TEAM&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB% TEAM&#39;</span><span class="p">,</span> <span class="s1">&#39;TS% OPP TEAM&#39;</span><span class="p">,</span> <span class="s1">&#39;TOV% OPP TEAM&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">team_stats</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">best_features_aic</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">team_stats</span><span class="p">[</span><span class="s2">&quot;W/L TEAM&quot;</span><span class="p">]</span>

<span class="c1"># Run logistic regression</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">Logit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
<p><img src="/portfolio_blog/images/copied_from_nb/images/results_table.png" alt="title" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature-Engineering">Feature Engineering<a class="anchor-link" href="#Feature-Engineering"> </a></h2><p>We made a few new features to help with converting player stats into team stats. They include:</p>
<p><code>Percentage of Field Goals Attempted</code>: $FGA\%_i = \frac{FGA_i}{FGA_{team}}$</p>
<p><code>Percentage of Free Throws Attempted</code>: $FTA\%_i = \frac{FTA_i}{FTA_{team}}$</p>
<p><code>Percentage of Game Played</code>: $GP\%_i = \frac{SP_i}{SP_{team}}$</p>
<p><code>Turnover Shot Ratio</code>: $TSr_i = \frac{TOV_i}{FGA_i}$</p>
<p>When we convert player stats to team stats, we made it so $FGA\%_i$, $FTA\%_i$, and $GP\%_i$ can be manually adjusted.</p>
<p>We calculated the team stats from the player stats in the following way. Here an $i$ subscript refers to player $i$, a $team$ subscript refers to the team as whole, $opp$ refers to the opposing team, and $N$ is the number of players that played during the given game. Here $FGA$ refers to field goals attempted (the number of shots during game play), $FTA$ refers to free throws attempted, $SP$ refers to seconds played during the game, and $TOV$ refers to the number of turnovers committed during the game. For the rest of the stat definitions, please see the table below.</p>
<p><img src="/portfolio_blog/images/copied_from_nb/images/table1.png" alt="title" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data-Visualization-and-Analysis">Data Visualization and Analysis<a class="anchor-link" href="#Data-Visualization-and-Analysis"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Are-certain-stats-correlated?">Are certain stats correlated?<a class="anchor-link" href="#Are-certain-stats-correlated?"> </a></h2><p><img src="/portfolio_blog/images/copied_from_nb/images/DRTG_vs_TSP.png" alt="title" /></p>
<p>Here we graph player True Shooting Percentage ($TS\%$) against Defensive Rating for the Opposing Team ($DRtg_{opp}$). Both graphs show that TS% has a faint positively correlation with defensive rating. The first graph includes outliers and in the second graph we remove outliers (players that didn't attempt many free throws/field goals or missed all their shots).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-do-the-stat-distributions-look-like?">What do the stat distributions look like?<a class="anchor-link" href="#What-do-the-stat-distributions-look-like?"> </a></h2><p><img src="/portfolio_blog/images/copied_from_nb/images/tl.png" alt="title" /></p>
<p>In order to normalize player stats we need to be able to draw from an empirical distribution from their play for the last two seaons. The graph on the left the True Shooting Percentage Distribution for Tobias Harris of the Philadelphia 76ers. The graph on the right shows kernal density estimations (KDEs) for true shooting and free throw percentage for all players in the league.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Who-wins-in-head-to-head-matchups?">Who wins in head to head matchups?<a class="anchor-link" href="#Who-wins-in-head-to-head-matchups?"> </a></h2><p><img src="/portfolio_blog/images/copied_from_nb/images/updated_predictions.png" alt="title" /></p>
<p>Once we pick players and sample their statistics, we can predict head to head matchups. On the right, the prediction was done by making 10,000 draws from each player's stats and combining them into team stats. We then ran the team stats through our model. We did not have 2 of the players' data (they were both rookies), so filled in one of their stats with a player with similar points per game.</p>
<p>As shown on the left, we found out that we can also predict head to head matchups between players. It might be a stretch to compare players because the model was fit on team data, but the results are reasonable.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-much-should-we-use-certain-players?">How much should we use certain players?<a class="anchor-link" href="#How-much-should-we-use-certain-players?"> </a></h2><p><img src="/portfolio_blog/images/copied_from_nb/images/rd_updated.png" alt="title" /></p>
<p>We ran simulations of the Utah Jazz against the Minnesota Timberwolves (the next team they were facing) to find the optimal playing time and field goals attempts for Donovan Mitchell and Rudy Gobert. On the left we see that as Donovan Mitchell plays more, the win probability of the Jazz goes down slightly. However the more Rudy Gobert plays, the better the team does. On the right, we see that we want Rudy Gobert to shoot the ball more and Donovan to shoot the ball less to help the team. This is important information for their coach.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-are-the-best-lineups-for-the-Utah-Jazz?">What are the best lineups for the Utah Jazz?<a class="anchor-link" href="#What-are-the-best-lineups-for-the-Utah-Jazz?"> </a></h2><p><img src="/portfolio_blog/images/copied_from_nb/images/best_jazz_lineup_updated.png" alt="title" /></p>
<p>We picked the 8 best players on the Jazz and looked at all the possible five-man lineups. Our best lineup hasn't played together on the Jazz before, but it seems like a reasonable lineup. Notice that all the best lineups include Rudy Gobert, which is consistent with our earlier results.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Method">Method<a class="anchor-link" href="#Method"> </a></h1><p>After doing exploratory data analysis, we divided our prediction method into three parts.</p>
<ol>
<li>Obtain Player Stat Predictions: We tried three different ways<ul>
<li>Directly using average data from past games</li>
<li>Regressing on average player data from past games</li>
<li>Drawing from an empirical distribution of past games</li>
</ul>
</li>
<li>Convert Player Stats into Team Stats: This is detailed in the "Feature Engineering" section</li>
<li>Classify Team Stats to determine game winner: Use a classifier to predict whether or not the away team won </li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Obtain-Player-Stat-Predictions">Obtain Player Stat Predictions<a class="anchor-link" href="#Obtain-Player-Stat-Predictions"> </a></h2><p>We decided to formulate the problem of predicting player stats as a regression problem instead of a time-series problem (the latter had little success). We ended up averaging the stats for the last 10 games for each player and applied regression techniques to predict there next game performance. Using average team, average opposing team, and average player stats as input, we created 14 different models to predict each of the individual player stats for any given game.</p>
<p>Random forests are a good starting point because they do not require much hyperparameter tuning, and we wanted to find out if predicting player stats through regression was promising or not before we spent a lot of time on it. Regressing on player stats turned out to be the least effective way to obtain player stat predictions in the overall method of predicting games. As a result, we didn't feel like we needed to spend extra time testing more models.</p>
<p>Another approach to obtain player stat predictions was simply to use their stat averages over the last 10 games. This approach actually turned out to be more effective the regressing on player stats with predicting games. This could be because we fed all of this data into a classifier that had been trained on average team data instead of regressed team data.</p>
<p>Lastly, obtained player stats by drawing them from an empirical distribution of past games. We drew N times from an empirical distribution over all previous games (since the 2017-2018 season) for each player. We found N=1000 to be a sufficient number of draws to promote consistent results.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Classify-Team-Stats-to-Determine-Game-Outcomes">Classify Team Stats to Determine Game Outcomes<a class="anchor-link" href="#Classify-Team-Stats-to-Determine-Game-Outcomes"> </a></h2><p>Once we had the away and home team stats, we could combine them into one feature vector and predict the game result. We tested many common machine learning classifiers and trained them on the team stats portion of our data set. Their results can be seen in following figure. The hyper-parameters were tuned using a 5-fold cross validation on all of the methods except XGBoost. We used a 80-20 train/validation split to train this method.</p>
<p><img src="/portfolio_blog/images/copied_from_nb/images/table2.png" alt="title" /></p>
<p>The data split is as follows: We used the team game data from 2017 to July 7, 2019 as our training set. We used data from July 7, 2019 to December 31, 2019 as our test set. Note that this was different than our final model test set, because in our final model we combined player statistics before predicting game outcomes. In the end, a linear support vector classifier did best overall, and we are not sure why this is the case.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Results">Results<a class="anchor-link" href="#Results"> </a></h1><p>Once we trained our classifier and regression models, we ran our algorithm all the way through and recorded the results. First, we obtained the player stats in the three ways mentioned in the methods section. These include using the rolling averages, regressing on the rolling averages, and drawing from an empirical distribution. After converting the player stats to team stats, we used our SVM classifier predict game outcomes based on team stats. These results are shown in the following figures.</p>
<p><img src="/portfolio_blog/images/copied_from_nb/images/roc_curves2.png" alt="title" /></p>
<p><img src="/portfolio_blog/images/copied_from_nb/images/table3.png" alt="title" /></p>
<p>In order achieve optimal results, we adjusted the classifier thresholds ($\tau$) to maximize accuracy. While this is infeasible to when predicting without labels, we noticed that the values of $\tau$ were often close to the average win/loss ratio for away teams. For our best model, this was around .44. This value is below .5 because it is more likely for the home team to win than the away team. We plan to use this win/loss ratio for any future predictions. We also calculated the Area Under the Curve (AUC), which may be a better representation of classifier performance in this scenario.</p>
<p>Surprisingly, drawing 1000 draws from empirical player distributions was the most effective way to predict player performance for each game. Since the stats were random and a large amount were drawn, this probably created a scenario that was more robust at predicting games.</p>
<p>While regressing on player stats did poorly overall, this could be because we trained the classifier on average stats instead of regressed stats. Our thinking was that our classifier, used to a less accurate dataset, would do better overall with regressed stats as input. However, regressed stats and average stats may be fundamentally different enough (regressed stats probably have higher variance) that this may have heavily affected classifier results.</p>
<h2 id="2020-Playoffs-Simulation">2020 Playoffs Simulation<a class="anchor-link" href="#2020-Playoffs-Simulation"> </a></h2><p>We put the current roster of each team and start the Playoff according to most recent rankings. The following figure is a visualization of our model's predictions put into a free online bracket.</p>
<p><img src="/portfolio_blog/images/copied_from_nb/images/model_prediction_playoffs.png" alt="title" /></p>
<h2 id="Player-Contributions-to-Winning">Player Contributions to Winning<a class="anchor-link" href="#Player-Contributions-to-Winning"> </a></h2><p>Once we had a good way to predict game outcomes, we wanted to see which players were most important to their team's success. We did this by replaying the 2019-2020 season (up until December 31, 2019) for each team while removing different players from the team. If the team win percentage increased, that means that the removed player contributed negatively to game results. On the other hand, if the win percentage decreased, it meant that the player contributed positively to their team's success. Note that our algorithm did not take into account strength of schedule, as this would impact the win percentage of some teams more than others.</p>
<p><img src="/portfolio_blog/images/copied_from_nb/images/7.png" alt="title" /></p>
<p>We noticed an interesting pattern with these results. Almost all of the players that had the most positive impact are tall players that play close to the basket. Almost all the players that had the most negative impact are smaller players that handle the ball often. This could be because tall players may have a bigger effect on the game due to the fact that they can more easily make and block shots. It could also be that our algorithm heavily rewards actions that big-men excel at: rebounding and field goal percentage. On the other hand, smaller players turn the ball over often and our algorithm may weigh this heavily.</p>
<p>It is important to note that our algorithm is not perfect and there may be other factors not accounted for. For instance, while the smaller players above may negatively influence their teams in certain scenarios (probably because of shot inefficiency at times) they are also needed to help the other players succeed. Donovan Mitchell, for instance, appears on the negative side of our graph but is known to bail is team out of difficult situations where no one else can score the ball. His ability to attack the hoop opens up his teammates' options. Our algorithm probably doesn't take this into account when it simulates the Utah Jazz season without Donovan Mitchell.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Ethics">Ethics<a class="anchor-link" href="#Ethics"> </a></h1><p>NBA game winning prediction is not only a interesting project to work on, but these predictions also attract people in the lottery industry. Both sports fans and speculators are interested in predictions on probabilities of game winning. This is something that many people bet money on, and many times it can lead to ethical problems. It is possible that referees and players try to fix game outcomes at times to win money. This will not only alter game outcomes, but the stats that we are using to analyze the different players. This is something we need to be aware of as we do future analysis and predictions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion"> </a></h1><p>In conclusion, there are many factors to consider besides overall team stats when trying to predict team performance. Our model combines individual player statistics to predict team performance and we achieve 69.60% accuracy on predictions for games in the 2019-2020 season. We are also able to analyze which players contribute the most and least to their team's success. We hope are findings are beneficial to sports fans, coaches, and even the players themselves as we all enjoy the game of basketball.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="References">References<a class="anchor-link" href="#References"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>[1] Manner, Hans. "Modeling and forecasting the outcomes of NBA basketball games." Journal of Quantitative Analysis in Sports 12, no. 1 (2016): 31-41.</p>
<p>[2] Loeffelholz, Bernard, Earl Bednar, and Kenneth W. Bauer. "Predicting NBA games using neural networks." Journal of Quantitative Analysis in Sports 5, no. 1 (2009).</p>
<p>[3] Cheng, Ge &amp; Zhang, Zhenyu &amp; Kyebambe, Moses &amp; Nasser, Kimbugwe. (2016). Predicting the Outcome of NBA Playoffs Based on the Maximum Entropy Principle. Entropy. 18. 450. 10.3390/e18120450.</p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/portfolio_blog/2020/09/22/NBA-Predictions-by-Combining-Player-Statistics.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/portfolio_blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/portfolio_blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/portfolio_blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" title="fastai"><svg class="svg-icon grey"><use xlink:href="/portfolio_blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/portfolio_blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
